<div class="container-fluid places-container">
  <%= form_tag(availabilities_path, method: "post", class: "row edit-places-form") do %>
    <div class="col-md-3 edit-places-nav">
      <div style="display: flex; height: 93px; padding: 8px 8px; justify-content: center; align-items: center; border-bottom: 1px solid #e0e0e0;">
        <h2 style="font-weight: normal; text-align: center;">Schedule Availability</h2>
      </div>
      <div style="display: flex; flex-direction: column; padding: 32px 40px; justify-content: space-around; border-bottom: 1px solid #e0e0e0;">
        <% if current_user.has_role?(:admin) %>
          <%= link_to "Places", availabilities_places_path, class: "btn btn-large btn-light btn-nav" %>
        <% end %>
      </div>
      <div style="display: flex; flex-direction: column; padding: 32px 40px; justify-content: space-around;">
        <%= submit_tag("Update", id: 'update-button', data: { disable_with: false }, class: "btn btn-large btn-primary disabled btn-nav") %>
        <%= submit_tag("Clear All", id: 'clear-all-button', data: { disable_with: false }, class: "btn btn-large btn-warning white-text btn-nav")%>
        <%= submit_tag("Cancel", id: 'cancel-button', data: { disable_with: false }, class: "btn btn-large btn-danger disabled btn-nav") %>
      </div>
    </div>
    <div class="col-md-9" style="height: 100%;">
      <div class="edit-places-table">
        <div class="edit-places-heading">
          <div class="edit-places-empty-heading">
          </div>
          <div class="heading-group">
            <% (1..7).each do |index| %>
              <div class="places-day-heading">
                <div class="places-day-text">
                  <%= Availability.days.keys[index % 7][0..2] %>
                </div>
              </div>
            <% end%>
            <div style="overflow: scroll;"></div>
          </div>
        </div>
        <div id="scroll-table">
          <div class="time-heading">
            <% (0..23).each do |x| %>
              <div class="time-block">
                <span class="time-text"<% if x == 0 %>, style="display: none;"<% end %>>
                  <%= "%02d:00" % x %>
                </span>
              </div>
            <% end %>
          </div>
          <div class="table-cells">
            <div>
              <% (0..23).each do |x| %>
                <div class="row-lines"></div>
              <% end %>
            </div>
            <% (1..7).each do |index| %>
              <% day = Availability.days.keys[index % 7] %>
              <div class="table-columns">
                <div class="table-columns-padded">
                  <% @time_ranges.each do |tr| %>
                    <% availability = @availabilities[[day, tr.id]] %>
                    <div class="availability" id="<%= "cell_#{availability.id}" %>" style="
                      top: <%= calc_offset(tr)%>px;
                      height: <%= calc_slot_height(tr) %>px;"
                      onclick="<%="toggle(#{availability.id})"%>">
                      <div class="availability-vertical" id="<%= "vertical_#{availability.id}" %>"></div>
                      <%= generate_cell(day, tr) %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<script>
  $(document).on('turbolinks:load', function(){
    document.getElementById("scroll-table").scrollTop = <%= calc_scroll_2 %>;
    $('input[type=checkbox]').each(function(id) {
      updateCheckbox($(this).val(), false);
    });
    $('#clear-all-button').click(function(e) {
      e.preventDefault();
      $('input[type=checkbox]').each(function(id) {
        $(this).prop('checked', false);
        updateCheckbox($(this).val(), true);
      });
      disableButton("clear-all-button");
    });
    $('#cancel-button').click(function(e) {
      e.preventDefault();
      location = location;
    });
    disableButton("update-button");
    disableButton("cancel-button");
  });
</script>

